const khmerData = {
    alphabet: [
        { char: 'ក', image: 'images/KH_Alphabet/Bitmap 0.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 0, endTime: 3 },
        { char: 'ខ', image: 'images/KH_Alphabet/Bitmap 1.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 3, endTime: 5 },
        { char: 'គ', image: 'images/KH_Alphabet/Bitmap 2.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 5, endTime: 8 },
        { char: 'ឃ', image: 'images/KH_Alphabet/Bitmap 3.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 8, endTime: 11 },
        { char: 'ង', image: 'images/KH_Alphabet/Bitmap 4.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 11, endTime: 13 },
        { char: 'ច', image: 'images/KH_Alphabet/Bitmap 5.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 13, endTime: 15 },
        { char: 'ឆ', image: 'images/KH_Alphabet/Bitmap 6.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 15, endTime: 18 },
        { char: 'ជ', image: 'images/KH_Alphabet/Bitmap 7.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 18, endTime: 22 },
        { char: 'ឈ', image: 'images/KH_Alphabet/Bitmap 8.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 21, endTime: 23 },
        { char: 'ញ', image: 'images/KH_Alphabet/Bitmap 9.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 23, endTime: 25 },
        { char: 'ដ', image: 'images/KH_Alphabet/Bitmap 10.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 26, endTime: 28 },
        { char: 'ឋ', image: 'images/KH_Alphabet/Bitmap 11.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 28, endTime: 31 },
        { char: 'ឌ', image: 'images/KH_Alphabet/Bitmap 12.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 31, endTime: 33 },
        { char: 'ឍ', image: 'images/KH_Alphabet/Bitmap 13.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 33, endTime: 36 },
        { char: 'ណ', image: 'images/KH_Alphabet/Bitmap 14.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 36, endTime: 38 },
        { char: 'ត', image: 'images/KH_Alphabet/Bitmap 15.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 38, endTime: 41},
        { char: 'ថ', image: 'images/KH_Alphabet/Bitmap 16.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 41, endTime: 43 },
        { char: 'ឌ', image: 'images/KH_Alphabet/Bitmap 17.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 43, endTime: 45.5 },
        { char: 'ធ', image: 'images/KH_Alphabet/Bitmap 18.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 45.5, endTime: 48 },
        { char: 'ន', image: 'images/KH_Alphabet/Bitmap 19.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 48, endTime: 50.5 },
        { char: 'ប', image: 'images/KH_Alphabet/Bitmap 20.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 50.5, endTime: 53 },
        { char: 'ផ', image: 'images/KH_Alphabet/Bitmap 21.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 53, endTime: 55 },
        { char: 'ព', image: 'images/KH_Alphabet/Bitmap 22.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 55, endTime: 57.5 },
        { char: 'ភ', image: 'images/KH_Alphabet/Bitmap 23.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 58, endTime: 60 },
        { char: 'ម', image: 'images/KH_Alphabet/Bitmap 24.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 60, endTime: 63 },
        { char: 'យ', image: 'images/KH_Alphabet/Bitmap 25.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 63, endTime: 65 },
        { char: 'រ', image: 'images/KH_Alphabet/Bitmap 26.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 65, endTime: 67 },
        { char: 'ល', image: 'images/KH_Alphabet/Bitmap 27.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 67.5, endTime: 69.5 },
        { char: 'វ', image: 'images/KH_Alphabet/Bitmap 28.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 70, endTime: 72 },
        { char: 'ស', image: 'images/KH_Alphabet/Bitmap 29.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 72.3, endTime: 74.5 },
        { char: 'ហ', image: 'images/KH_Alphabet/Bitmap 30.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 74.5, endTime: 76.5 },
        { char: 'ឡ', image: 'images/KH_Alphabet/Bitmap 31.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 76.5, endTime: 78.5 },
        { char: 'អ', image: 'images/KH_Alphabet/Bitmap 32.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 78.5, endTime: 81 },
    ],
    vowels: [
        { char: 'ា', image: 'images/KH_Vowels/2.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 0, endTime: 2 },
        { char: 'ិ', image: 'images/KH_Vowels/3.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 2, endTime: 4 },
        { char: 'ី', image: 'images/KH_Vowels/4.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 4, endTime: 6 },
        { char: 'ឹ', image: 'images/KH_Vowels/5.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 6, endTime: 8 },
        { char: 'ឺ', image: 'images/KH_Vowels/6.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 8, endTime: 10 },
        { char: 'ុ', image: 'images/KH_Vowels/7.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 10, endTime: 12 },
        { char: 'ូ', image: 'images/KH_Vowels/8.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 12, endTime: 14 },
        { char: 'ួ', image: 'images/KH_Vowels/9.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 14, endTime: 16 },
        { char: 'ើ', image: 'images/KH_Vowels/10.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 16, endTime: 18 },
        { char: 'ឿ', image: 'images/KH_Vowels/11.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 18, endTime: 20 },
        { char: 'ៀ', image: 'images/KH_Vowels/12.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 20, endTime: 22 },
        { char: 'េ', image: 'images/KH_Vowels/13.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 22, endTime: 24 },
        { char: 'ែ', image: 'images/KH_Vowels/14.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 24, endTime: 26 },
        { char: 'ៃ', image: 'images/KH_Vowels/15.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 26, endTime: 28 },
        { char: 'ោ', image: 'images/KH_Vowels/16.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 28, endTime: 29.5 },
        { char: 'ៅ', image: 'images/KH_Vowels/17.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 29.5, endTime: 31 },
        { char: 'ុំ', image: 'images/KH_Vowels/18.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 31, endTime: 33 },
        { char: 'ំ', image: 'images/KH_Vowels/19.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 33, endTime: 35 },
        { char: 'ាំ', image: 'images/KH_Vowels/20.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 35, endTime: 37 },
        { char: 'ះ', image: 'images/KH_Vowels/21.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 37, endTime: 39 },
        { char: 'ុះ', image: 'images/KH_Vowels/22.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 39, endTime: 41 },
        { char: 'េះ', image: 'images/KH_Vowels/23.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 41, endTime: 42 },
        { char: 'ោះ', image: 'images/KH_Vowels/24.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 42, endTime: 45 },
    ],
    numbers: [
        { char: '១', image: 'images/number/1.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 2, endTime: 4 },
        { char: '២', image: 'images/number/2.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 4, endTime: 6.5 },
        { char: '៣', image: 'images/number/3.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 6.5, endTime: 8.5 },
        { char: '៤', image: 'images/number/4.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 8.5, endTime: 10.5 },
        { char: '៥', image: 'images/number/5.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 10.5, endTime: 12.5 },
        { char: '៦', image: 'images/number/6.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 12.5, endTime: 14.5 },
        { char: '៧', image: 'images/number/7.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 14.5, endTime: 16.5 },
        { char: '៨', image: 'images/number/8.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 16.5, endTime: 18.5 },
        { char: '៩', image: 'images/number/9.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 18.5, endTime: 20 },
        { char: '១០', image: 'images/number/10.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 20, endTime: 22.5 },
    ],
};

let currentAudio = null; // To store the currently playing audio object

function playSound(character) {
    try {
        // If there's a currently playing audio, stop it
        if (currentAudio) {
            currentAudio.pause();
            currentAudio.currentTime = 0; // Reset to the beginning of the *entire* clip.  Important!
        }

        const audio = new Audio(`sounds/${character.sound}.mp3`); // Construct the audio file path

        // Set start and end times
        audio.currentTime = character.startTime;
        const endTime = character.endTime;

        audio.addEventListener('timeupdate', function() {
            if (this.currentTime >= endTime) {
                this.pause();
                this.currentTime = character.startTime; // Reset for potential future play
            }
        });

        audio.play();
        currentAudio = audio; // Store the current audio object

    } catch (error) {
        console.error("Error playing sound:", error);
    }
}

function displayCharacter(character, imageSrc, youtubeId) {
    document.getElementById('displayed-character').textContent = character;

    const videoButton = document.getElementById('play-video-button');
    if (youtubeId) {
        videoButton.style.display = 'block'; // Show the button
        videoButton.onclick = () => {
           window.open(`https://www.youtube.com/watch?v=${youtubeId}`, '_blank');
        };
    } else {
        videoButton.style.display = 'none'; // Hide the button if no video
    }

    document.getElementById('displayed-image').src = imageSrc;

    // Get meta elements
    const metaVideo = document.getElementById('meta-youtube-video');
    const metaVideoSecure = document.getElementById('meta-youtube-video-secure');

    if (youtubeId) {
        const videoUrl = `https://www.youtube.com/embed/${youtubeId}`;

        // Set the content of the meta elements
        metaVideo.setAttribute('content', videoUrl);
        metaVideoSecure.setAttribute('content', videoUrl);

        const videoContainer = document.getElementById('youtube-video-container');
        videoContainer.innerHTML = '';

    } else {
         // Clear meta elements if no video available
        metaVideo.setAttribute('content', '');
        metaVideoSecure.setAttribute('content', '');
    }
}

function createCharacterGrid(sectionId, dataArray, prefix) {
    const grid = document.getElementById(sectionId);
    grid.innerHTML = ''; // Clear existing content

    dataArray.forEach(item => {
        const cell = document.createElement('div');
        cell.className = 'character-cell';

        const button = document.createElement('button');
        button.type = 'button';
        button.setAttribute('aria-hidden', 'true');
        button.onclick = function() {
            playSound(item); // Pass the entire item object
            displayCharacter(prefix + " " + item.char, item.image, item.youtubeId);
        };

        const image = document.createElement('img');
        image.src = item.image;
        image.alt = item.char;
        image.width = 100;
        image.height = 71;

        button.appendChild(document.createTextNode(item.char));
        button.appendChild(image);

        cell.appendChild(button);
        grid.appendChild(cell);
    });
}

// Call these functions after the DOM is loaded.
document.addEventListener('DOMContentLoaded', () => {
    createCharacterGrid('character-grid-alphabet', khmerData.alphabet, 'អក្សរ');
    createCharacterGrid('character-grid-numbers', khmerData.numbers, 'លេខ');
    createCharacterGrid('character-grid-vowels', khmerData.vowels, 'ស្រៈ​ ');
});
