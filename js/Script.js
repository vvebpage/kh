

const khmerData = {
    alphabet: [
        { char: '', image: 'images/KH_Alphabet/Bitmap 0.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 0, endTime: 3 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 1.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 3, endTime: 6 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 2.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 6, endTime: 9 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 3.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 9, endTime: 12 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 4.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 12, endTime: 15 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 5.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 15, endTime: 18 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 6.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 18, endTime: 21 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 7.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 21, endTime: 24 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 8.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 24, endTime: 27 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 9.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 27, endTime: 30 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 10.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 30, endTime: 33 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 11.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 33, endTime: 36 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 12.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 36, endTime: 39 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 13.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 39, endTime: 42 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 14.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 42, endTime: 45 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 15.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 45, endTime: 48 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 16.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 48, endTime: 51 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 17.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 51, endTime: 54 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 18.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 54, endTime: 57 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 19.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 57, endTime: 60 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 20.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 60, endTime: 63 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 21.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 63, endTime: 66 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 22.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 66, endTime: 69 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 23.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 69, endTime: 72 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 24.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 72, endTime: 75 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 25.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 75, endTime: 78 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 26.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 78, endTime: 81 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 27.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 81, endTime: 84 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 28.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 84, endTime: 87 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 29.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 87, endTime: 90 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 30.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 90, endTime: 93 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 31.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 93, endTime: 96 },
        { char: '', image: 'images/KH_Alphabet/Bitmap 32.png', sound: '01', youtubeId: 'dQw4w9WgXcQ', startTime: 96, endTime: 99 },
        
    ],
    vowels: [
        { char: '', image: 'images/KH_Vowels/2.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 99, endTime: 102},
        { char: '', image: 'images/KH_Vowels/3.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 102, endTime: 105 },
        { char: '', image: 'images/KH_Vowels/4.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 105, endTime: 108 },
        { char: '', image: 'images/KH_Vowels/5.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 108, endTime: 111 },
        { char: '', image: 'images/KH_Vowels/6.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 111, endTime: 114 },
        { char: '', image: 'images/KH_Vowels/7.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 114, endTime: 117 },
        { char: '', image: 'images/KH_Vowels/8.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 117, endTime: 120 },
        { char: '', image: 'images/KH_Vowels/9.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 120, endTime: 123 },
        { char: '', image: 'images/KH_Vowels/10.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 123, endTime: 126 },
        { char: '', image: 'images/KH_Vowels/11.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 126, endTime: 129 },
        { char: '', image: 'images/KH_Vowels/12.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 129, endTime: 132 },
        { char: '', image: 'images/KH_Vowels/13.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 132, endTime: 135 },
        { char: '', image: 'images/KH_Vowels/14.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 135, endTime: 138 },
        { char: '', image: 'images/KH_Vowels/15.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 138, endTime: 141 },
        { char: '', image: 'images/KH_Vowels/16.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 141, endTime: 144 },
        { char: '', image: 'images/KH_Vowels/17.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 144, endTime: 147 },
        { char: '', image: 'images/KH_Vowels/18.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 147, endTime: 150 },
        { char: '', image: 'images/KH_Vowels/19.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 150, endTime: 153 },
        { char: '', image: 'images/KH_Vowels/20.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 153, endTime: 156 },
        { char: '', image: 'images/KH_Vowels/21.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 156, endTime: 159 },
        { char: '', image: 'images/KH_Vowels/22.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 159, endTime: 162 },
        { char: '', image: 'images/KH_Vowels/23.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 162, endTime: 165 },
        { char: '', image: 'images/KH_Vowels/24.png', sound: '02', youtubeId: 'dQw4w9WgXcQ', startTime: 165, endTime: 168 }
    ],
    numbers: [
        { char: '', image: 'images/number/1.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 168, endTime: 171 },
        { char: '', image: 'images/number/2.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 171, endTime: 174 },
        { char: '', image: 'images/number/3.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 174, endTime: 177 },
        { char: '', image: 'images/number/4.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 177, endTime: 180 },
        { char: '', image: 'images/number/5.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 180, endTime: 183 },
        { char: '', image: 'images/number/6.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 183, endTime: 186 },
        { char: '', image: 'images/number/7.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 186, endTime: 189 },
        { char: '', image: 'images/number/8.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 189, endTime: 192 },
        { char: '', image: 'images/number/9.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 192, endTime: 195 },
        { char: '', image: 'images/number/10.png', sound: '03', youtubeId: 'dQw4w9WgXcQ', startTime: 195, endTime: 198 }
        
    ],
    
};

// Data for English Alphabet
const englishData = {
    alphabet: [
        { char: 'A', sound: 'a', image: 'images/A.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'B', sound: 'b', image: 'images/B.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'C', sound: 'c', image: 'images/C.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'D', sound: 'd', image: 'images/D.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'E', sound: 'e', image: 'images/E.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'F', sound: 'f', image: 'images/F.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'G', sound: 'g', image: 'images/G.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'H', sound: 'h', image: 'images/H.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'I', sound: 'i', image: 'images/I.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'J', sound: 'j', image: 'images/J.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'K', sound: 'k', image: 'images/K.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'L', sound: 'l', image: 'images/L.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'M', sound: 'm', image: 'images/M.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'N', sound: 'n', image: 'images/N.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'O', sound: 'o', image: 'images/O.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'P', sound: 'p', image: 'images/P.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'Q', sound: 'q', image: 'images/Q.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'R', sound: 'r', image: 'images/R.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'S', sound: 's', image: 'images/S.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'T', sound: 't', image: 'images/T.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'U', sound: 'u', image: 'images/U.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'V', sound: 'v', image: 'images/V.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'W', sound: 'w', image: 'images/W.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'X', sound: 'x', image: 'images/X.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'Y', sound: 'y', image: 'images/Y.png', youtubeId: null, startTime: 0, endTime: 5 },
        { char: 'Z', sound: 'z', image: 'images/Z.png', youtubeId: null, startTime: 0, endTime: 5 }
    ]
};

// This function is now reusable
function createCharacterGrid(sectionId, dataArray, prefix) {
    const grid = document.getElementById(sectionId);
    grid.innerHTML = '';

    dataArray.forEach(item => {
        const cell = document.createElement('div');
        cell.className = 'character-cell';

        const button = document.createElement('button');
        button.type = 'button';
        button.setAttribute('aria-hidden', 'true');
        button.onclick = function() {
            // Play the sound
            if (typeof item.sound === 'string' && item.sound.trim() !== '') { //Check if a sound is defined for a character to prevent audio errors
               playSound(item);
            }
            //displayCharacter(prefix + " " + item.char, item.image, item.youtubeId);
        };

        const image = document.createElement('img');
        image.src = item.image;
        image.alt = item.char;
        image.width = 100;
        image.height = 71;

        button.appendChild(document.createTextNode(item.char));
        button.appendChild(image);

        cell.appendChild(button);
        grid.appendChild(cell);
    });
}

let currentAudio = null; // To store the currently playing audio object

function playSound(character) {
    try {
        // If there's a currently playing audio, stop it
        if (currentAudio) {
            currentAudio.pause();
            currentAudio.currentTime = 0; // Reset to the beginning of the *entire* clip.  Important!
        }

        const audio = new Audio(`sounds/${character.sound}.mp3`); // Construct the audio file path

        // Set start and end times
        audio.currentTime = character.startTime;
        const endTime = character.endTime;

        audio.addEventListener('timeupdate', function() {
            if (this.currentTime >= endTime) {
                this.pause();
                this.currentTime = character.startTime; // Reset for potential future play
            }
        });

        audio.play();
        currentAudio = audio; // Store the current audio object

    } catch (error) {
        console.error("Error playing sound:", error);
    }
}

function displayCharacter(character, imageSrc, youtubeId) {
    document.getElementById('displayed-character').textContent = character;

    const videoButton = document.getElementById('play-video-button');
    if (youtubeId) {
        videoButton.style.display = 'block'; // Show the button
        videoButton.onclick = () => {
           window.open(`https://www.youtube.com/watch?v=${youtubeId}`, '_blank');
        };
    } else {
        videoButton.style.display = 'none'; // Hide the button if no video
    }

    document.getElementById('displayed-image').src = imageSrc;

    // Get meta elements
    const metaVideo = document.getElementById('meta-youtube-video');
    const metaVideoSecure = document.getElementById('meta-youtube-video-secure');

    if (youtubeId) {
        const videoUrl = `https://www.youtube.com/embed/${youtubeId}`;

        // Set the content of the meta elements
        metaVideo.setAttribute('content', videoUrl);
        metaVideoSecure.setAttribute('content', videoUrl);

        const videoContainer = document.getElementById('youtube-video-container');
        videoContainer.innerHTML = '';

    } else {
         // Clear meta elements if no video available
        metaVideo.setAttribute('content', '');
        metaVideoSecure.setAttribute('content', '');
    }
}

function createCharacterGrid(sectionId, dataArray, prefix) {
    const grid = document.getElementById(sectionId);
    grid.innerHTML = ''; // Clear existing content

    dataArray.forEach(item => {
        const cell = document.createElement('div');
        cell.className = 'character-cell';

        const button = document.createElement('button');
        button.type = 'button';
        button.setAttribute('aria-hidden', 'true');
        button.onclick = function() {
            playSound(item); // Pass the entire item object
            displayCharacter(prefix + " " + item.char, item.image, item.youtubeId);
        };

        const image = document.createElement('img');
        image.src = item.image;
        image.alt = item.char;
        image.classList.add('character-image');

        button.appendChild(document.createTextNode(item.char));
        button.appendChild(image);

        cell.appendChild(button);
        grid.appendChild(cell);
    });
}

// Call these functions after the DOM is loaded.
document.addEventListener('DOMContentLoaded', () => {
    const khmerSection = document.getElementById('khmer-section');
    const englishSection = document.getElementById('english-section');
    const toggleKhmerButton = document.getElementById('toggle-khmer');
    const toggleEnglishButton = document.getElementById('toggle-english');

    createCharacterGrid('character-grid-alphabet', khmerData.alphabet, 'អក្សរ');
    createCharacterGrid('character-grid-numbers', khmerData.numbers, 'លេខ');
    createCharacterGrid('character-grid-vowels', khmerData.vowels, 'ស្រៈ​ ');
    createCharacterGrid('character-grid-english', englishData.alphabet, 'English'); // Added to show English also

    toggleKhmerButton.addEventListener('click', () => {
        khmerSection.style.display = 'block';
        englishSection.style.display = 'none';
    });

    toggleEnglishButton.addEventListener('click', () => {
        khmerSection.style.display = 'none';
        englishSection.style.display = 'block';
    });

    // Initially hide Khmer and show English
    khmerSection.style.display = 'none';
    englishSection.style.display = 'block';
});
